<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Debug</title>
    <style>
        body {
            font-family: monospace;
            background: #0a0e27;
            color: #00f5ff;
            padding: 40px;
        }
        .info { margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px; }
        button { padding: 15px 30px; font-size: 18px; margin: 10px; cursor: pointer; }
        .error { color: #ff006e; }
        .success { color: #00f5ff; }
    </style>
</head>
<body>
    <h1>üéµ Music Debug Tool</h1>
    
    <div class="info">
        <h2>File Information:</h2>
        <p>Music URL: <span id="musicUrl"></span></p>
        <p>Can Access: <span id="canAccess"></span></p>
        <p>File Size: <span id="fileSize"></span></p>
        <p>Content Type: <span id="contentType"></span></p>
    </div>
    
    <div class="info">
        <h2>Audio Player:</h2>
        <audio id="audio" controls style="width: 100%">
            <source src="music.mp3" type="audio/mpeg">
        </audio>
        <p>Duration: <span id="duration"></span></p>
        <p>Ready State: <span id="readyState"></span></p>
        <p>Network State: <span id="networkState"></span></p>
        <p>Error: <span id="error"></span></p>
    </div>
    
    <div class="info">
        <h2>Controls:</h2>
        <button onclick="testPlay()">‚ñ∂Ô∏è Test Play</button>
        <button onclick="testPause()">‚è∏Ô∏è Pause</button>
        <button onclick="checkFile()">üîç Check File</button>
        <button onclick="downloadTest()">üíæ Try Download</button>
    </div>
    
    <div class="info">
        <h2>Console Logs:</h2>
        <div id="logs" style="max-height: 300px; overflow-y: auto; background: #000; padding: 10px;"></div>
    </div>
    
    <script>
        const audio = document.getElementById('audio');
        const logs = document.getElementById('logs');
        
        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff006e' : type === 'success' ? '#00ff00' : '#00f5ff';
            logs.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }
        
        // Set music URL
        document.getElementById('musicUrl').textContent = new URL('music.mp3', window.location.href).href;
        
        // Check file on load
        window.addEventListener('load', () => {
            log('Page loaded, checking file...');
            checkFile();
        });
        
        // Audio event listeners
        audio.addEventListener('loadstart', () => log('üîÑ Loading started...'));
        audio.addEventListener('loadedmetadata', () => {
            log('‚úÖ Metadata loaded', 'success');
            document.getElementById('duration').textContent = audio.duration + ' seconds';
        });
        audio.addEventListener('loadeddata', () => log('‚úÖ Data loaded', 'success'));
        audio.addEventListener('canplay', () => log('‚úÖ Can play!', 'success'));
        audio.addEventListener('playing', () => log('‚ñ∂Ô∏è Playing...', 'success'));
        audio.addEventListener('pause', () => log('‚è∏Ô∏è Paused'));
        audio.addEventListener('error', (e) => {
            const error = audio.error;
            let msg = '‚ùå Error: ';
            if (error) {
                switch(error.code) {
                    case 1: msg += 'MEDIA_ERR_ABORTED'; break;
                    case 2: msg += 'MEDIA_ERR_NETWORK'; break;
                    case 3: msg += 'MEDIA_ERR_DECODE'; break;
                    case 4: msg += 'MEDIA_ERR_SRC_NOT_SUPPORTED'; break;
                }
                msg += ' - ' + error.message;
            }
            log(msg, 'error');
            document.getElementById('error').textContent = msg;
        });
        
        // Update states
        setInterval(() => {
            document.getElementById('readyState').textContent = audio.readyState + ' (' + getReadyStateText(audio.readyState) + ')';
            document.getElementById('networkState').textContent = audio.networkState + ' (' + getNetworkStateText(audio.networkState) + ')';
        }, 500);
        
        function getReadyStateText(state) {
            const states = ['HAVE_NOTHING', 'HAVE_METADATA', 'HAVE_CURRENT_DATA', 'HAVE_FUTURE_DATA', 'HAVE_ENOUGH_DATA'];
            return states[state] || 'UNKNOWN';
        }
        
        function getNetworkStateText(state) {
            const states = ['NETWORK_EMPTY', 'NETWORK_IDLE', 'NETWORK_LOADING', 'NETWORK_NO_SOURCE'];
            return states[state] || 'UNKNOWN';
        }
        
        function testPlay() {
            log('Attempting to play...');
            audio.play()
                .then(() => log('‚úÖ Play successful!', 'success'))
                .catch(err => log('‚ùå Play failed: ' + err.message, 'error'));
        }
        
        function testPause() {
            audio.pause();
            log('Paused');
        }
        
        async function checkFile() {
            try {
                log('Checking music.mp3...');
                const response = await fetch('music.mp3', { method: 'HEAD' });
                
                if (response.ok) {
                    log('‚úÖ File accessible!', 'success');
                    document.getElementById('canAccess').textContent = '‚úÖ Yes';
                    document.getElementById('canAccess').className = 'success';
                    
                    const size = response.headers.get('content-length');
                    const type = response.headers.get('content-type');
                    
                    document.getElementById('fileSize').textContent = size ? (size / 1024 / 1024).toFixed(2) + ' MB' : 'Unknown';
                    document.getElementById('contentType').textContent = type || 'Unknown';
                    
                    log(`File size: ${size} bytes (${(size/1024/1024).toFixed(2)} MB)`, 'success');
                    log(`Content type: ${type}`, 'success');
                } else {
                    log('‚ùå File not accessible: ' + response.status, 'error');
                    document.getElementById('canAccess').textContent = '‚ùå No (' + response.status + ')';
                    document.getElementById('canAccess').className = 'error';
                }
            } catch (err) {
                log('‚ùå Error checking file: ' + err.message, 'error');
                document.getElementById('canAccess').textContent = '‚ùå Error: ' + err.message;
                document.getElementById('canAccess').className = 'error';
            }
        }
        
        function downloadTest() {
            log('Opening music.mp3 in new tab...');
            window.open('music.mp3', '_blank');
        }
    </script>
</body>
</html>
